[SERVICE]
    Flush         5
    Daemon        Off
    Log_Level     info
    Parsers_File  /fluent-bit/etc/parsers.conf

# Collect Docker container logs
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*.log
    Parser            docker
    Tag               docker.*
    Refresh_Interval  5
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    DB                /fluent-bit/etc/docker-logs.db

# Filter to add container metadata
[FILTER]
    Name          parser
    Match         docker.*
    Key_Name      log
    Parser        json_parser
    Reserve_Data  True

# Add hostname and timestamp
[FILTER]
    Name          record_modifier
    Match         *
    Record        hostname ${HOSTNAME}
    Record        environment production

# Extract container name from tag
[FILTER]
    Name          lua
    Match         docker.*
    Script        /fluent-bit/etc/extract_container.lua
    Call          extract_container_name

# Output to Elasticsearch
[OUTPUT]
    Name            es
    Match           *
    Host            elasticsearch
    Port            9200
    Index           bigdata.dev
    Type            _doc
    Logstash_Format Off
    Suppress_Type_Name On
    Replace_Dots    On
    Retry_Limit     5
    Generate_ID     On
